name: PowerShell Dashboard Test

on: [push, pull_request]

jobs:
  test-dashboard:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run dashboard script headless
        shell: pwsh
        run: |
          $job = Start-Job { .\Start-SystemDashboard.ps1 -Port 8899 }
$maxRetries = 10
$success = $false
for ($i = 0; $i -lt $maxRetries; $i++) {
    Start-Sleep -Seconds 2
    try {
        $response = Invoke-WebRequest -Uri "http://localhost:8899/" -UseBasicParsing -TimeoutSec 2
        if ($response.StatusCode -eq 200) {
            $success = $true
            break
        }
    } catch {
        # Service not responding yet, try again
    }
}
if (-not $success) { throw "Dashboard failed to respond after waiting." }
Stop-Job $job | Remove-Job -Force
